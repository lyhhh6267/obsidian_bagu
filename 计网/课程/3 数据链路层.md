
数据链路层的基本概念：**数据链路层**在物理层提供服务的基础上向**网络层提供服务**，其最基本的服务是将源自网络层来的数据可靠地传输到相邻结点的网络层。其主要作用是**加强物理层传输原始比特流的功能**，将物理层提供的可能出错的物理连接**改造成为逻辑上无差错的数据链路**，使之对网络层表现为一条无差错的链路。

# 一、数据链路层基础

![[Pasted image 20221116231648.png]]

![[Pasted image 20221116231725.png]]

## 1.1 数据链路和帧

- **结点 (node)** 是指网络中的主机、路由器等。

- **链路 (link)** 又称**物理链路**是一条点到点的物理线路段，中间没有任何其他的交换结点。**一条链路只是一条通路的一个组成部分**。

- **数据链路** (data link) 又称**逻辑链路**除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。

1.现在最常用的方法是使用**适配器**（即网卡)来实现这些协议的硬件和软件。

2.一般的适配器都包括了**数据链路层**和**物理层**这两层的功能。SSSSSSSSSSSSSSSSSSS

![[Pasted image 20221116165559.png]]

![[Pasted image 20221116165623.png]]

## 1.2 数据链路层三个基本问题

### 1.2.1 封装成帧

^eff817

**封装成帧** (framing) 就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。**首部和尾部包含了许多的控制信息**。

首部和尾部中有**帧定界符**，其作用是进行**帧定界（接收端识别开始和结束）**。

![[Pasted image 20221116170231.png]]

用控制字符进行帧定界的方法举例:

- 当数据是由ASCII 码组成的文本文件时，帧定界可以使用特殊的帧定界符。
- 控制字符 SOH (Start Of Header) 放在一帧的最前面，表示帧的首部开始。另一个控制字符 EOT (End Of Transmission) 表示帧的结束。

![[Pasted image 20221116171320.png]]

**帧同步**：接收方应当能从接收到的二进制比特流中区分出帧的起始和终止。

### 1.2.2 透明传输

^7ff6bc

- 透明传输是指不管所传数据是什么样的比特组合，都能够在链路上传送。因此，链路层应该“**看不见**”有什么妨碍数据传输的东西。
- 如果数据中的某字节的二进制代码恰好和 SOH 或 EOT 一样，链路层就会错误地“找到帧的边界”。

![[Pasted image 20221116172610.png]]

#### 解决方法：字符计数法

**字符计数法**，在帧首部使用计数字段来表明帧内字符数。**不足之处，一错，错全部**

![[Pasted image 20221116172746.png]]

#### 解决方法：字符填充(character stuffing)

- 发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面**插入一个转义字符“ESC”**(其十六进制编码是1B)。
- 接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。
- 如果转义字符也出现在数据当中，那么应在转义字符前面插入一个转义字符 ESC。当接收端收到连续的两个转义字符时，就删除其中前面的一个。

![[Pasted image 20221116225952.png]]

### 1.2.3 差错检测

^7a96bb

在传输过程中可能会产生差错，传输中的差错都是由于噪声引起的。


**全局性噪声**：由于线路本身的电气特性所产生的**随机噪声**，是信道固有的，随机存在的。
    解决办法：提高信噪比来减少或避免干扰。

**局部性噪声**：外界特定的短暂原因造成的**冲击噪声**，是产生差错的主要原因。
    解决办法：通常利用编码技术来解决

位错类型包括：

- 位错：比特位出错：1 可能会变成 0， 而 0 也可能变成 1。
- 帧错：
	- 1、丢失：收到[#1]-[#3]
	- 2、重复：收到[#1]-[#2]-[#2]-[#3]
	- 3、乱序：收到[#1]-[#3]-[#2]
	- ——通过编号解决



比特差错：1 可能会变成 0， 而 0 也可能变成 1。

![[Pasted image 20221116231042.png]]

#### 奇偶校验

奇偶检验码：n-1位信息元，1位校验元。

#### 循环冗余检验的原理

- 在发送端，先把数据划分为组。假定每组 k 个比特。
- 在每组 M 后面再添加供差错检测用的 n 位**冗余码**，然后一起发送出去。

![[Pasted image 20221116231307.png]]

![[Pasted image 20221116231335.png]]

![[Pasted image 20221116231350.png]]

#### 冗余码的计算

![[Pasted image 20221116231418.png]]

##### 接收端对收到的每一帧进行 CRC 检验

- (1) 若得出的余数 R = 0，则判定这个帧没有差错，就接受 (accept)。
- (2) 若余数 R ≠ 0，则判定这个帧有差错，就丢弃。
- 只要经过严格的挑选，并使用位数足够多的除数 P，那么出现检测不到的差错的概率就很小很小。
- **但这种检测方法仍然并不能确定究竟是哪一个或哪几个比特出现了差错。**

##### 注意

- 仅用循环冗余检验 CRC 差错检测技术只能做到无差错接受 (accept)。
- “无差错接受”是指：“凡是接受的帧（即不包括丢弃的帧），我们都能以非常接近于 1 的概率认为这些帧在传输过程中没有产生差错”。
- 单纯使用 CRC 差错检测技术不能实现“可靠传输”。
- 要做到“可靠传输” （即发送什么就收到什么）就必须再加上确认和重传机制。
- 本章介绍的数据链路层协议都不是可靠传输的协议。

# 二、点对点协议PPP

## 2.1 PPP协议的特点

- 对于点对点的链路，目前使用得最广泛的数据链路层协议是**点对点协议 PPP** (Point-to-Point Protocol)。
- PPP 协议在 1994 年就已成为互联网的正式标准。
- PPP 协议主要用于广域网（多个城市多个国家的因特网）

### 2.1.1 PPP协议应满足的需求

- [[#^eff817|封装成帧]] —— 必须规定特殊的字符作为帧定界符。
- [[#^7ff6bc|透明传输]]—— 必须保证数据传输的透明性。
- [[#^7a96bb|差错检测]] —— 能够对接收端收到的帧进行检测，并立即丢弃有差错的帧。
- 多种网络层协议 —— 在同一条物理链路上同时支持多种网络层协议，**即封装的IP数据报可以采用多种协议（IP、OSI）**。
- 多种类型链路 —— 能够在多种类型的链路上运行（如串行/并行，同步/异步，电/光）。
- 检测连接状态 —— 能够及时自动检测出链路是否处于正常工作状态。
- 最大传送单元 —— 必须对每一种类型的点对点链路设置最大传送单元  MTU 的标准默认值（一般是1500字节），促进各种实现之间的互操作性（**不能无限长**）。
- 网络层地址协商 —— 必须提供一种机制使通信的两个网络层实体能够通过协商知道或能够配置彼此的网络层地址。
- 数据压缩协商 —— 必须提供一种方法来协商使用数据压缩算法。

### 2.1.2 PPP协议不需要的功能

- 不需要纠错（只需要检查）
- 不需要流量控制
- 不需要序号
- 不需要多点线路 （只需要点对点的功能）
- 不需要考虑半双工或单工链路

### 2.1.3 PPP协议的组成

PPP 协议有三个组成部分：
1. 一个将 IP 数据报封装到串行链路（同步串行/异步串行）的方法。
2. 链路控制协议 LCP (Link Control Protocol)。——身份验证，建立并维护数据链路连接。
3. 网络控制协议 NCP (Network Control Protocol)。——PPP可以兼容多种网络层协议。每个不同的网络层协议都要有相应NCP来配置，为网络层协议建立和配置逻辑连接。

![[Pasted image 20221116233526.png]]

## 2.2 PPP协议的帧格式

 - PPP 帧的首部和尾部分别为 4 个字段和 2 个字段。
 - **PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节。**

![[Pasted image 20221116235137.png]]

### 透明传输问题

当 PPP 用在**异步传输**时，就使用一种特殊的**字符填充法**。

当 PPP 用在**同步传输**链路时，协议规定采用硬件来完成**比特填充**。

#### 字符填充

将信息字段中出现的每一个 0x7E 字节转变成为 2 字节序列 (0x7D, 0x5E)。

若信息字段中出现一个 0x7D 的字节, 则将其转变成为 2 字节序列 (0x7D, 0x5D)。

若信息字段中出现 ASCII 码的控制字符（即数值小于 0x20 的字符），则在该字符前面要加入一个 0x7D 字节，同时将该字符的编码加以改变。

![[Pasted image 20221117183836.png]]

#### 零比特填充

PPP 协议用在链路时，使用同步传输（一连串的比特连续传送）。这时 PPP 协议采用零比特填充方法来实现透明传输。

在发送端，只要发现有 5 个连续 1，则立即填入一个 0。

接收端对帧中的比特流进行扫描。每当发现 5 个连续1时，就把这 5 个连续 1 后的一个 0 删除。

![[Pasted image 20221117183921.png]]

# 三、使用广播信道的数据链路层

## 3.1 局域网的数据链路层

局域网最主要的**特点**是：
1. 网络为一个单位所拥有；
2. 地理范围和站点数目均有限。

局域网具有如下**主要优点**：
1. 使用广播信道，各站点关系平等。局域网上的主机可共享连接在局域网上的各种硬件和软件资源。
2. 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。
3. 通信延时短，误码率低，可靠性较高。
4. 数据传输速率范围在10Mb/s~10Gb/s。

局域网拓扑结构：

![[Pasted image 20221117184247.png]]

### 3.1.1 以太网

- IEEE 802.3 是第一个 IEEE 的以太网标准。
- DIX Ethernet V2 是世界上第一个局域网产品（以太网）的规约。
- DIX Ethernet V2 标准与 IEEE 的 802.3 标准只有很小的差别，因此可以将 802.3 局域网简称为“以太网”（10M bit/s）。
- 严格说来，“以太网”应当是指符合 DIX Ethernet V2 标准的局域网 。


### 3.1.2 GB，ISO，IEC，IEEE标准有什么区别？

- GB是国家标准的汉语拼音简写，是中国的国家标准。
- IEC是国际电工委员会的简称，相应的是这个国际标准化组织制订的标准，主要是电工领域的国际标准。
- ISO是国际标准化组织的简称，相应标准用ISO+编号来指示，比IEC的标准范围相比更加广泛。
- IEEE 是电气和电子工程师协会的简称，制订的标准涉及太空、计算机、电信、生物医学、电力及消费性电子产品等领域。

### 3.1.3 以太网把数据链路层分成了LLC子层和MAC子层

![[Pasted image 20221117184712.png]]

### 3.1.4 以太网采取了两种重要的措施

为了通信的简便，以太网采取了两种重要的措施：

1. 采用较为灵活的无连接的工作方式
	1. 不必先建立连接就可以直接发送数据。
	2. 对发送的数据帧不进行编号，也不要求对方发回确认。
	3. 这样做的理由是局域网信道的质量很好，因信道质量产生差错的概率是很小的。
	4. 以太网只实现无差错接收，不实现可靠传输。

2. 以太网发送的数据都使用**曼彻斯特** (Manchester) 编码（**高频、自同步**）

![[Pasted image 20221117193651.png]]

![[Pasted image 20221117193708.png]]

### 3.1.5 媒体共享技术

- 静态划分信道
	1. 频分复用FDM
	2. 时分复用TDM
	3. 波分复用WDM
	4. 码分复用CDM

- 动态媒体接入控制（多点接入）
	1. **随机接入**（**CSMA**/ALOHA等协议）
	2. 受控接入 ，如多点线路探询 (polling)，或轮询。

## 3.2 CSMA/CD协议

最初的以太网是将许多计算机都连接到一根总线上。易于实现广播通信。当初认为这样的连接方法既简单又可靠，因为总线上没有有源器件。

![[Pasted image 20221117194350.png]]

为了实现一对一通信，将接收站的硬件地址写入帧首部中的目的地址字段中。仅当数据帧中的目的地址与适配器的硬件地址一致时，才能接收这个数据帧。

![[Pasted image 20221117194426.png]]

总线也有缺点。若多台计算机或多个站点同时发送时，会产生发送碰撞或冲突，导致发送失败。

![[Pasted image 20221117194538.png]]

### 3.2.1 CSMA/CD 含义

- CSMA/CD 含义：载波监听多点接入 / 碰撞检测  (Carrier Sense Multiple Access with Collision Detection) 。
- “**多点接入**”表示许多计算机以多点接入的方式连接在一根总线上。
- “**载波监听**”是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞。
- **“载波监听”就是用电子技术检测总线上有没有其他计算机发送的数据信号。**
- “**碰撞检测**”（Collision Detection）就是计算机边发送数据边检测信道上的信号电压大小。
- 当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）。
- 当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。
- **所谓“碰撞”就是发生了冲突。因此“碰撞检测”也称为“冲突检测”。**

在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息来。

CSMA/CD （载波监听多点接入 / 碰撞检测）：每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要**立即停止发送**，免得继续浪费网络资源，然后**等待一段随机时间**后再次发送。

![[Pasted image 20221117194825.png]]

为什么要进行碰撞检测？ 因为信号传播时延对载波监听产生了影响

![[Pasted image 20221117195101.png]]

#### 争用期

最先发送数据帧的站，在发送数据帧后**至多**经过时间 **2t （两倍的端到端往返时延）**就可知道发送的数据帧是否遭受了碰撞。

以太网的端到端往返时延 2t  称为**争用期**，或**碰撞窗口**。

**经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞**。

#### 二进制指数类型退避算法 (truncated binary exponential type)

发生碰撞的站在停止发送数据后，要推迟（退避）一个随机时间才能再发送数据。

1. 基本退避时间取为争用期 2t 。
2. 从整数集合 [0, 1, … , (2k - 1)] 中随机地取出一个数，记为 r。重传所需的时延就是 r 倍的基本退避时间。
3. 参数 k 按下面的公式计算：
		k = Min[重传次数, 10]
4. 当 k ≤10 时，参数 k 等于重传次数。
5. 5.当重传达 16 次仍不能成功时即丢弃该帧（网络拥挤），并向高层报告。

![[Pasted image 20221117195318.png]]

![[Pasted image 20221117195327.png]]

#### 最短有效帧长

- 如果发生冲突，就一定是在发送的前 64 字节之内。
- 由于一检测到冲突就立即中止发送，这时已经发送出去的数据一定小于 64 字节。
- 以太网规定了最短有效帧长为 64 字节，凡长度小于 64 字节的帧都是由于冲突而异常中止的无效帧。

#### 覆盖范围

![[Pasted image 20221117200247.png]]

#### 人为干扰信号

![[Pasted image 20221117200320.png]]

### 3.2.2 CSMA/CD 协议的要点

![[Pasted image 20221117200356.png]]

### 3.2.3 CSMA/CD 协议的重要特性

使用 CSMA/CD 协议的以太网不能进行全双工通信而**只能****进行双向交替通信（半双工通信）。**

每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。

这种**发送的不确定性**使整个以太网的平均通信量远小于以太网的最高数据率。

## 3.3 使用集线器的星型拓扑

传统以太网最初是使用粗同轴电缆，后来演进到使用比较便宜的细同轴电缆，最后发展为使用更便宜和更灵活的双绞线。

采用双绞线的以太网采用星形拓扑，在星形的中心则增加了一种可靠性非常高的设备，叫做**集线器 (hub)**。

![[Pasted image 20221117200933.png]]

![[Pasted image 20221117200943.png]]

![[Pasted image 20221117200956.png]]

### 3.3.1 集线器的一些特点

- 集线器是使用电子器件来模拟实际电缆线的工作，因此整个系统仍然像一个传统的以太网那样运行。
- **使用集线器的以太网在==逻辑上仍是一个总线网==，各工作站使用的还是 CSMA/CD 协议，并==共享逻辑上的总线==。**
- 集线器很像一个多接口的转发器，**工作在物理层。**
- 集线器采用了专门的芯片，进行自适应串音回波抵消，减少了近端串音。

![[Pasted image 20221117201109.png]]

## 3.4 以太网的信道利用率

多个站在以太网上同时工作就可能会发生碰撞。

当发生碰撞时，信道资源实际上是被浪费了。因此，当扣除碰撞所造成的信道损失后，**以太网总的信道利用率并不能达到 100%**。

假设t（tao） 是以太网单程端到端传播时延。则争用期长度为 2t ，即端到端传播时延的两倍。检测到碰撞后不发送干扰信号。

设帧长为 L (bit)，数据发送速率为 C (bit/s)，则帧的发送时间为  T0 = L/C (s)。

### 以太网信道被占用的情况

一个站在发送帧时出现了碰撞。经过一个争用期 2t 后，可能又出现了碰撞。这样经过若干个争用期后，一个站发送成功了。假定发送帧需要的时间是 T0 。

![[Pasted image 20221117201951.png]]

![[Pasted image 20221117202005.png]]

对以太网参数 a 的要求

为提高利用率，以太网的参数 a 的值应当尽可能小些。

对以太网参数 a 的要求是：
	1.当数据率一定时，以太网的连线的长度要受到限制，否则 t  的数值会太大。
	2.以太网的帧长不能太短，否则 T0 的值会太小，使 a 值太大。

## 3.5 以太网的 MAC 层

硬件：以太网适配器

网络接口板又称为**通信适配器** (adapter) 或**网络接口卡** NIC (Network Interface Card)，或“**网卡**”。

适配器的重要功能：
1. 在计算机的操作系统安装设备驱动程序。
2. 进行串行/并行转换。
3. 对数据进行缓存。
4. 实现以太网协议。

![[Pasted image 20221117202303.png]]

### 3.5.1 MAC层的硬件地址

在局域网中，**硬件地址**又称为**物理地址**，或 **MAC 地址（全球唯一）**。

l802 标准所说的“地址”严格地讲应当是每一个站的“**名字**”或**标识符**。

但鉴于大家都早已习惯了将这种 48 位的“名字”称为“地址”，所以本书也采用这种习惯用法，尽管这种说法并不太严格。

**请注意，如果连接在局域网上的主机或路由器安装有多个适配器，那么这样的主机或路由器就有多个“地址”。更准确些说，这种 48 位“地址”应当是某个接口的标识符。**

#### 48位的MAC地址

IEEE 802 标准规定 MAC 地址字段可采用 6 字节 (48位) 或 2 字节 (16位) 这两种中的一种。

IEEE 的注册管理机构 RA 负责向厂家分配地址字段 6 个字节中的前三个字节 (即高位 24 位)，称为组织唯一标识符。

地址字段 6 个字节中的后三个字节 (即低位 24 位) 由厂家自行指派，称为扩展唯一标识符，必须保证生产出的适配器没有重复地址。

![[Pasted image 20221117203421.png]]

#### 单站地址、组地址、广播地址

IEEE 规定地址字段的第一字节的最低位为 I/G 位。I/G 表示 Individual / Group。

**当 I/G 位 = 0 时**，地址字段表示一个**单站地址**。

**当 I/G 位 = 1 时**，表示**组地址**，用来进行多播（以前曾译为组播）。此时，IEEE 只分配地址字段前三个字节中的 23 位。

当 I/G 位分别为 0 和 1 时，一个地址块可分别生成 2^23 个单个站地址和 2^23 个组地址。

#### 适配器检查 MAC 地址

适配器从网络上每收到一个 MAC 帧就首先用硬件检查 MAC 帧中的 MAC 地址。

1.如果是发往本站的帧则收下，然后再进行其他的处理。
2.否则就将此帧丢弃，不再进行其他的处理。

“发往本站的帧”包括以下三种帧：

1.单播 (unicast) 帧（一对一）
2.广播 (broadcast) 帧（一对全体）
3.多播 (multicast) 帧（一对多）

### 3.5.2 MAC帧的格式

常用的以太网 MAC 帧格式有两种标准：

**1.DIX Ethernet V2 标准
2.IEEE 的 802.3 标准**

两种帧只有微小的区别，可以在以太网共存。

最常用的 MAC 帧是**以太网 V2 的格式**。

![[Pasted image 20221117204209.png]]

#### 无效的MAC帧

- 帧的长度不是整数个字节；
- 用收到的帧检验序列 FCS 查出有差错；
- 数据字段的长度不在 46 ~ 1500 字节之间。
- 有效的 MAC 帧长度为 64 ~ 1518 字节之间。

对于检查出的无效 MAC 帧就简单地丢弃。以太网不负责重传丢弃的帧。

# 四、扩展的以太网

## 4.1 在物理层扩展以太网

### 使用光纤扩展

1. 主机使用光纤（通常是一对光纤）和一对光纤调制解调器连接到集线器。
2. 很容易使主机和几公里以外的集线器相连接。

![[Pasted image 20221117204710.png]]

### 使用集线器扩展

使用集线器扩展：将多个以太网段连成更大的、多级星形结构的以太网。

![[Pasted image 20221117204742.png]]

优点：
1.使原来属于不同碰撞域的以太网上的计算机能够进行跨碰撞域的通信。

2.扩大了以太网覆盖的地理范围。

缺点：
1.碰撞域增大了。

2.如果不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来。

### 碰撞域

碰撞域（collision domain）又称为冲突域，是指网络中一个站点发出的帧会与其他站点发出的帧产生碰撞或冲突的那部分网络。

![[Pasted image 20221117205221.png]]

## 4.2 在数据链路层扩展以太网

扩展以太网更常用的方法是在数据链路层进行。

早期使用网桥，现在使用以太网交换机。

![[Pasted image 20221117205508.png]]

- 网桥工作在数据链路层。

- 它根据 MAC 帧的目的地址对收到的帧进行转发和过滤。

- 当网桥收到一个帧时，并不是向所有的接口转发此帧，而是**先检查此帧的目的 MAC 地址**，然后再确定将该帧转发到哪一个接口，或把它丢弃。

- 1990 年问世的交换式集线器 (switching hub) 可明显地提高以太网的性能。

- 交换式集线器常称为以太网交换机 (switch) 或第二层交换机 (L2 switch)，强调这种交换机工作在数据链路层。

### 4.2.1 以太网交换机的特点

- 以太网交换机实质上就是一个多接口的网桥。通常都有十几个或更多的接口。

- 每个接口都直接与一个单台主机或另一个以太网交换机相连

- 以太网交换机具有并行性。能同时连通多对接口，使多对主机能同时通信。

- 相互通信的主机都是独占传输媒体，无碰撞地传输数据。
![[Pasted image 20221118143317.png]]

- 以太网交换机的接口有存储器，能在输出端口繁忙时把到来的帧进行缓存。

- 以太网交换机是一种即插即用设备，其内部的帧交换表（又称为地址表）是通过自学习算法自动地逐渐建立起来的。

- 以太网交换机的作用远远大于普通的集线器，而且价格并不贵。

### 4.2.2 以太网交换机的优点

用户独享带宽，增加了总容量。

![[Pasted image 20221118143431.png]]

热插拔：从共享总线以太网转到交换式以太网时，所有接入设备的软件和硬件、适配器等都不需要做任何改动。

以太网交换机一般都具有多种速率的接口，方便了各种不同情况的用户。

### 4.2.3 以太网交换机的交换方式

- 存储转发方式
	把整个数据帧先缓存后再进行处理。

- 直通 (cut-through) 方式
	1. 接收数据帧的同时就立即按数据帧的目的 MAC 地址决定该帧的转发接口，因而提高了帧的转发速度。
	2. 缺点是它不检查差错就直接将帧转发出去，因此有可能也将一些无效帧转发给其他的站。

在某些情况下，仍需要采用基于软件的存储转发方式进行交换，例如，当需要进行线路速率匹配、协议转换或差错检测时。

### 4.2.4 交换机使用了生成树协议

IEEE 802.1D 标准制定了一个**生成树协议 STP**  (Spanning Tree Protocol)。

其要点是：**不改变**网络的实际拓扑，但在逻辑上则切断某些链路，使得从一台主机到所有其他主机的路径是**无环路的树状结构**，从而消除了兜圈子现象。

![[Pasted image 20221118143744.png]]

### 4.2.5 从总线以太网到星型以太网

- 之前，以太网采用无源的总线结构。
- 现在，采用以太网交换机的星形结构成为以太网的首选拓扑。
- 总线以太网使用 CSMA/CD 协议，以半双工方式工作。
- 以太网交换机不使用共享总线，没有碰撞问题，因此不使用 CSMA/CD 协议，以全双工方式工作。但仍然采用以太网的帧结构。

![[Pasted image 20221118144011.png]]

![[Pasted image 20221118144041.png]]

**广播域（broadcast domain）**：指这样一部分网络，其中任何一台设备发出的广播通信都能被该部分网络中的所有其他设备所接收。

每个接口都处于一个独立的碰撞域（或冲突域）中，但所有计算机都处于同一个广播域中。

## 4.3 虚拟局域网

- IEEE 802.1Q 对虚拟局域网 VLAN 的定义：
	虚拟局域网 VLAN 是由一些局域网网段构成的与物理位置无关的逻辑组，而这些网段具有某些共同的需求。每一个 VLAN 的帧都有一个明确的标识符，指明发送这个帧的计算机是属于哪一个 VLAN。

- 虚拟局域网其实只是局域网给用户提供的一种服务，而并不是一种新型局域网。

- 由于虚拟局域网是用户和网络资源的逻辑组合，因此可按照需要将有关设备和资源非常方便地重新组合，使用户从不同的服务器或数据库中存取所需的资源。

### 4.3.1 虚拟局域网优点

虚拟局域网（VLAN）技术具有以下主要优点：

1. 改善了性能——避免的广播风暴，节省了带宽
2. 简化了管理——只需要网管改改配置
3. 降低了成本——不需要购买更多的设备
4. 改善了安全性——隔离的数据

### 4.3.2 划分虚拟局域网的方法

- 基于交换机端口

![[Pasted image 20221118145113.png]]

- 基于计算机网卡的MAC地址

![[Pasted image 20221118145151.png]]

- 基于协议类型

![[Pasted image 20221118145212.png]]

- 基于IP子网地址

![[Pasted image 20221118145221.png]]

- 基于高层应用或服务

![[Pasted image 20221118145232.png]]

### 4.3.3 虚拟局域网使用的以太网帧格式

IEEE 批准了 802.3ac 标准，该标准定义了**以太网的帧格式的扩展**，以支持虚拟局域网。

虚拟局域网协议允许在以太网的帧格式**中插入一个4字节的标识符**，称为 VLAN 标记 (tag)，用来指明该帧属于哪一个虚拟局域网。

插入VLAN标记得出的帧称为 **802.1Q 帧或带标记的以太网帧。**

![[Pasted image 20221118145353.png]]

![[Pasted image 20221118145405.png]]